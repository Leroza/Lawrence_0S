<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leroza.dev - Retro OS Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Retro Terminal Font -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <style>
        /* Define Custom Colors for Theme */
        :root {
            --color-khaki: #C3B091; /* Aged Amber/Terminal Main Color */
            --color-maroon: #500000; /* Deep Background Accent */
            --color-black: #000000;
            --color-white: #FFFFFF;
            --color-orange: #ff8c00; /* Action/Highlight Color */
            --color-danger: #ff0000;
            --color-safe: #00ff00;
        }

        /*
        * 1. Global Reset & Scroll Snap Setup (Retro Font Applied)
        */
        body {
            cursor: none; /* Hide default cursor */
            font-family: 'VT323', monospace;
            background-color: var(--color-black); 
            color: var(--color-khaki); 
            height: 100vh;
            /* Use smooth scrolling for navigation links */
            scroll-behavior: smooth; 
            scroll-snap-type: y mandatory;
            padding-bottom: 70px; 
            position: relative;
            overflow-x: hidden;
        }

        section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-snap-align: start;
            /* Increased spacing and centered on all devices */
            padding: 8rem 1rem 6rem 1rem; 
            text-shadow: 0 0 5px var(--color-khaki), 0 0 10px rgba(195, 176, 145, 0.4);
        }
        
        /* ----------------------------------------------------
        * CRT OVERLAY & GLITCH EFFECTS (Minimal Custom CSS)
        * ---------------------------------------------------- */
        #crt-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10000; opacity: 0.9;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.7), 0 0 10px rgba(0, 0, 0, 0.8);
            background: repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.3) 1px, transparent 1px, transparent 2px);
            filter: blur(0.3px) contrast(1.1);
            transform: perspective(1000px) rotateX(0deg) rotateY(0deg); 
        }

        /* Glitch Keyframes */
        @keyframes glitchFlicker {
            0%, 70% { text-shadow: 0 0 5px var(--color-maroon), 0 0 10px rgba(80, 0, 0, 0.4); transform: translate(0, 0); }
            75% { text-shadow: 2px 0px 5px var(--color-danger), -2px 0px 5px rgb(0, 255, 255); transform: translate(1px, 0.5px); }
            80% { text-shadow: -1px 1px 5px rgb(255, 0, 255), 1px -1px 5px var(--color-safe); transform: translate(-1.5px, -1px); }
            85% { text-shadow: 1px -1px 5px var(--color-orange), -1px 1px 5px var(--color-white); transform: translate(0.5px, 0.5px); }
            90%, 100% { text-shadow: 0 0 5px var(--color-maroon), 0 0 10px rgba(80, 0, 0, 0.4); transform: translate(0, 0); }
        }
        .constant-glitch { animation: glitchFlicker 1.2s infinite steps(1); }
        #glitching-identity { color: var(--color-khaki); z-index: 51; padding: 10px; }

        /*
        * 2. The Pixel Plane Cursor (Chunky Pixel Art)
        */
        #plane-cursor {
            position: fixed;
            width: 32px; 
            height: 32px;
            pointer-events: none;
            z-index: 10001;
            top: 0;
            left: 0;
            transform: translate(-50%, -50%);
            transition: transform 0.05s linear;
        }
        
        .plane-body {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px; 
            height: 2px;
            background-color: var(--color-khaki); 
            /* Detailed 5x5 pixel plane structure using 4px offsets */
            box-shadow: 
                /* Main Body Center Column */
                0 -8px var(--color-khaki), 0 -4px var(--color-khaki), 
                0 4px var(--color-khaki), 0 8px var(--color-khaki),
                
                /* Main Body Left/Right (1 pixel wide) */
                -4px 0 var(--color-khaki), 4px 0 var(--color-khaki),
                -8px 0 var(--color-khaki), 8px 0 var(--color-khaki),
                
                /* Wings (Top spread, 7 wide) */
                -12px 4px var(--color-khaki), 12px 4px var(--color-khaki),
                -8px 4px var(--color-khaki), 8px 4px var(--color-khaki),
                -4px 4px var(--color-khaki), 4px 4px var(--color-khaki),
                
                /* Firing Tip (2 pixels higher than center) */
                0 -12px var(--color-khaki),
                /* Firing Port Indicator (3 pixels higher) - Brighter for bullet origin */
                0 -16px var(--color-orange); 
            transform: translate(-50%, -50%);
        }

        /* ----------------------------------------------------
        * DYNAMIC ELEMENTS
        * ---------------------------------------------------- */
        .bullet {
            position: fixed; width: 8px; height: 8px;
            background-color: var(--color-orange); 
            border-radius: 50%; z-index: 9999;
            box-shadow: 0 0 10px var(--color-orange), 0 0 30px var(--color-orange); 
            pointer-events: none;
        }
        
        .destroyed {
            opacity: 0 !important;
            transform: scale(0.5) translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        /* Typography Overrides (Maximized Spacing) */
        .max-type-title {
            font-size: 8rem; line-height: 0.9; margin-bottom: 2rem;
        }
        @media (min-width: 768px) {
            .max-type-title { font-size: 14rem; }
        }

        .max-type-subtitle {
            font-size: 3rem; line-height: 1.1; margin-top: 3rem; 
        }
        @media (min-width: 768px) {
             .max-type-subtitle { font-size: 5rem; }
        }
        
        .max-type-skill-label {
            font-size: 2.5rem; line-height: 1.1;
        }
    </style>
</head>
<body>

    <!-- CRT Overlay for Scanlines and Curvature Effect -->
    <div id="crt-overlay" aria-hidden="true"></div>

    <!-- The Custom Plane Cursor -->
    <div id="plane-cursor" aria-hidden="true">
        <div class="plane-body"></div>
    </div>

    <!-- Bullet Container & Effects -->
    <div id="bullet-container"></div>
    <div id="confetti-container"></div>
    <div id="explosion-flash"></div>
    <div id="victory-glitch"></div>
    <div id="project-preview" class="fixed top-0 left-0 hidden z-20 pointer-events-none opacity-0">
        <div id="preview-box" class="p-2 border-4 border-[var(--color-orange)] bg-[var(--color-black)] text-[var(--color-khaki)] shadow-lg" style="width: 400px;">
            <p class="text-xl mb-2 text-center border-b border-[var(--color-khaki)]">FILE\_PREVIEW.IMG</p>
            <img id="preview-image" src="" alt="Project Preview Placeholder" class="w-full h-auto" onerror="this.onerror=null;this.src='https://placehold.co/400x250/ff0000/ffffff?text=ERROR'; document.getElementById('preview-box').style.width='400px'">
        </div>
    </div>

    <!-- Top-Left Glitching Identity (OS Title) -->
    <div id="glitching-identity" class="fixed top-0 left-0 text-xl md:text-3xl font-extrabold tracking-widest hidden sm:block constant-glitch">
        LEROZA.<span id="glitch-title" class="text-[var(--color-orange)]">DEV</span>
    </div>

    <!-- HUD / TASKBAR (Fixed to the BOTTOM) -->
    <header id="hud-bar" class="fixed bottom-0 left-0 right-0 z-50 p-3 hud-bar">
        <nav class="flex justify-between items-center max-w-7xl mx-auto w-full text-lg">
            
            <!-- Group 1 (Left: HP & Targets) -->
            <div class="flex items-center space-x-4 md:space-x-6 mx-auto md:mx-0">
                
                <!-- Health Bar Visual -->
                <div class="flex items-center space-x-2">
                    <span class="text-xl text-[var(--color-maroon)]">TARGETS:</span>
                    <div class="health-bar-frame w-20 md:w-28">
                        <div id="health-fill" class="health-bar-fill" style="width: 100%;"></div>
                    </div>
                </div>

                <!-- Skills/Toggles HUD -->
                <div id="skills-hud" class="hidden sm:flex space-x-2 text-sm font-bold">
                    <span id="skill-1" class="skill-button cursor-pointer on">[1] SPREAD: OFF</span>
                    <span id="skill-2" class="skill-button cursor-pointer">[2] REPAIR (5%)</span>
                    <span id="skill-3" class="skill-button cursor-pointer on">[3] GUN: ACTIVE</span>
                </div>
            </div>

            <!-- Group 2 (Right: Navigation Links) -->
            <div class="flex space-x-4 md:space-x-6 text-base font-bold">
                <a href="#intro" class="text-[var(--color-maroon)] hover:text-[var(--color-orange)] transition duration-200">[ HOME ]</a>
                <a href="#about" class="text-[var(--color-maroon)] hover:text-[var(--color-orange)] transition duration-200">[ ABOUT ]</a>
                <a href="#skills" class="text-[var(--color-maroon)] hover:text-[var(--color-orange)] transition duration-200">[ SKILLS ]</a>
                <a href="#projects" class="text-[var(--color-maroon)] hover:text-[var(--color-orange)] transition duration-200">[ PROJECTS ]</a>
                <a href="#contact" class="text-[var(--color-maroon)] hover:text-[var(--color-orange)] transition duration-200">[ CONNECT ]</a>
            </div>
        </nav>
    </header>

    <!-- SECTION 1: HOME (Maroon Background) -->
    <section id="intro" class="bg-[var(--color-maroon)]">
        <div class="text-center max-w-7xl px-4">
            
            <h2 class="max-type-title font-extrabold text-[var(--color-khaki)] destructible-text" data-section="intro">
                OS // LEROZA.DEV 
            </h2>
            <p class="max-type-subtitle font-light text-[var(--color-white)] destructible-text" data-section="intro">
                SYSTEM INITIATED. TARGETS ONLINE.
            </p>
            <p class="max-type-subtitle font-light text-[var(--color-white)] mt-8 text-2xl md:text-4xl destructible-text" data-section="intro">
                DESTROY ALL TARGETS TO UNLOCK FINAL SCORE.
            </p>
        </div>
    </section>

    <!-- SECTION 2: ABOUT (Khaki Background) -->
    <section id="about" class="bg-[var(--color-khaki)]">
        <div class="text-center max-w-5xl px-4 text-[var(--color-maroon)] flex flex-col items-center justify-center space-y-8 md:space-y-12">
             <h2 class="max-type-title font-extrabold destructible-text" data-section="about">
                USER_FILE
            </h2>
            <div class="text-left space-y-6 max-w-3xl text-2xl md:text-3xl">
                <p class="destructible-text" data-section="about">
                    // I am a Frontend Combat Specialist dedicated to creating elegant, high-performance web experiences. My expertise lies in translating complex designs into robust, pixel-perfect UIs, with a specialty in modern JavaScript frameworks.
                </p>
                <p class="destructible-text" data-section="about">
                    // Deployment Status: Active. Mission Objective: Deliver functional, responsive, and visually stunning applications that push the boundaries of user interaction.
                </p>
            </div>
        </div>
    </section>

    <!-- SECTION 3: SKILLS (Maroon Background) - Dedicated Matrix -->
    <section id="skills" class="bg-[var(--color-maroon)]">
        <div class="text-center max-w-7xl px-4 text-[var(--color-khaki)]">
            <h2 class="max-type-title font-extrabold mb-12 destructible-text" data-section="skills">
                SKILL_MATRIX
            </h2>
            
            <div class="skill-matrix-section text-left w-full md:w-[900px] p-8 md:p-12 relative mx-auto">
                
                <h3 class="max-type-subtitle font-extrabold text-[var(--color-khaki)] mb-8 border-b-4 border-b-[var(--color-khaki)] pb-2 text-[var(--color-khaki)]">
                    PROGRAMMING // CAPACITIES
                </h3>
                
                <div id="skill-list" class="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-10"> 
                    <!-- Skills populated by JS -->
                </div>

                <p class="max-type-subtitle font-extralight text-[var(--color-khaki)] mt-12 text-[var(--color-khaki)]">
                    // PERCENTAGES ARE TARGETS. DESTROY ALL TO PROVE MASTERY.
                </p>
            </div>
        </div>
    </section>

    <!-- SECTION 4: PROJECTS (Khaki Background) -->
    <section id="projects" class="bg-[var(--color-khaki)]">
        <div class="text-center max-w-7xl px-4 text-[var(--color-maroon)]">
            <h2 class="max-type-title font-extrabold mb-12 destructible-text" data-section="projects">
                PROJECT_LOG
            </h2>
            <!-- New Folder List Structure -->
            <div id="project-folder-list" class="mt-16 text-left max-w-3xl mx-auto space-y-4">
                
                <div class="folder-item destructible-text max-type-skill-label bg-[var(--color-khaki)] text-[var(--color-maroon)]" data-section="projects" 
                    onmouseover="showPreview(event, 'https://placehold.co/400x250/500000/C3B091?text=GAME+UI+SCREENSHOT')"
                    onmouseout="hidePreview()">
                    > [DIR] GAME\_UI\_V1 (2024)
                </div>
                
                <div class="folder-item destructible-text max-type-skill-label bg-[var(--color-khaki)] text-[var(--color-maroon)]" data-section="projects" 
                    onmouseover="showPreview(event, 'https://placehold.co/400x250/C3B091/500000?text=WEB+APP+DASHBOARD')"
                    onmouseout="hidePreview()">
                    > [DIR] WEB\_APP\_V2 (2023)
                </div>
                
                <div class="folder-item destructible-text max-type-skill-label bg-[var(--color-khaki)] text-[var(--color-maroon)]" data-section="projects" 
                    onmouseover="showPreview(event, 'https://placehold.co/400x250/ff8c00/FFFFFF?text=3D+MODEL+RENDER')"
                    onmouseout="hidePreview()">
                    > [DIR] 3D\_ASSETS\_PACK (2022)
                </div>
                
                <div class="folder-item destructible-text max-type-skill-label bg-[var(--color-khaki)] text-[var(--color-maroon)]" data-section="projects" 
                    onmouseover="showPreview(event, 'https://placehold.co/400x250/00ff00/500000?text=AI+BOT+INTEGRATION')"
                    onmouseout="hidePreview()">
                    > [FILE] AI\_ENGINE\_V1.EXE
                </div>
                
            </div>
        </div>
    </section>

    <!-- SECTION 5: CONTACT (Maroon Background) -->
    <section id="contact" class="bg-[var(--color-maroon)]">
        <div class="text-center max-w-7xl px-4 text-[var(--color-khaki)]">
            <h2 class="max-type-title font-extrabold mb-12 destructible-text" data-section="contact">
                SYSTEM_SHUTDOWN
            </h2>
            <p class="max-type-subtitle font-light text-[var(--color-white)] mt-8 destructible-text" data-section="contact">
                LEROZA@DEV.IO // TERMINATION POINT
            </p>
            <div class="mt-16">
                <!-- Contact Button: Hard lines, orange hover, inverse colors -->
                <a href="mailto:leroza@dev.io" class="inline-block px-10 py-6 text-3xl font-bold bg-[var(--color-khaki)] text-[var(--color-maroon)] rounded-none shadow-2xl border-4 border-white hover:bg-[var(--color-orange)] hover:text-white transition duration-300 transform hover:scale-105">
                    INITIATE_CONTACT
                </a>
            </div>
        </div>
    </section>

    <script>
        // --- Game Setup and Constants ---
        const planeCursor = document.getElementById('plane-cursor');
        const bulletContainer = document.getElementById('bullet-container');
        const healthFillElement = document.getElementById('health-fill');
        const confettiContainer = document.getElementById('confetti-container');
        const skillListElement = document.getElementById('skill-list');
        const explosionFlash = document.getElementById('explosion-flash');
        const glitchTitleEl = document.getElementById('glitch-title');
        
        // Preview elements
        const projectPreview = document.getElementById('project-preview');
        const previewImage = document.getElementById('preview-image');
        const previewBox = document.getElementById('preview-box');

        // Core Game Constants
        const BULLET_SPEED = 20; 
        const FIRE_RATE = 100; 
        const REPAIR_AMOUNT = 5; 

        // Consolidated Skill Data (Updated list for richer content)
        const SKILL_DATA = [
            { name: "HTML/CSS/TAILWIND", percent: 95, color: '#ff8c00' }, 
            { name: "JAVASCRIPT (ES6+)", percent: 95, color: '#00ff00' },
            { name: "REACT/NEXT.JS", percent: 90, color: '#00ff00' },
            { name: "TYPESCRIPT", percent: 85, color: '#00ff00' },
            { name: "NODE/EXPRESS", percent: 80, color: '#ffff00' },
            { name: "FIREBASE/MONGO", percent: 75, color: '#ff0000' },
            { name: "UX/UI DESIGN", percent: 90, color: '#ff8c00' }, 
            { name: "VERSION CONTROL (GIT)", percent: 95, color: '#00ff00' },
        ];

        // --- State Variables ---
        let mouseX = 0;
        let mouseY = 0;
        let lastBulletTime = 0;
        let bullets = [];
        let targets = []; 
        let totalTargets = 0;
        let destroyedTargets = 0;
        let gameOver = false;
        let hideTimeout;
        let spreadShotActive = false;
        let isFiring = true; 
        
        /**
         * 1. Populates the dedicated skill matrix section with destructible targets.
         */
        function setupSkillsMatrixSection() {
            // Clear existing targets only for the skill list area
            targets = targets.filter(span => !span.closest('#skill-list')); 
            skillListElement.innerHTML = ''; 

            SKILL_DATA.forEach(skill => {
                const skillLine = document.createElement('div');
                skillLine.className = `max-type-skill-label font-light chaotic-skill destructible-text flex flex-col md:flex-row items-start md:items-center justify-between space-y-2 md:space-y-0`;
                skillLine.style.animationDelay = `-${Math.random()}s`;

                // Name (Maroon text on Khaki section's maroon background container)
                const nameContainer = document.createElement('span');
                nameContainer.className = 'skill-name text-white mr-4'; // Use white for high contrast inside the maroon skill box
                nameContainer.textContent = `${skill.name}`;
                skillLine.appendChild(nameContainer);

                // Destructible part (Percentage)
                const percentContainer = document.createElement('span');
                percentContainer.className = 'flex';

                const destructibleText = `${skill.percent}%`;
                destructibleText.split('').forEach(char => {
                    const span = document.createElement('span');
                    span.textContent = char === ' ' ? '\u00A0' : char; 
                    span.dataset.destroyed = 'false';
                    span.style.color = skill.color; // Color-coded by strength
                    
                    percentContainer.appendChild(span);
                    
                    if (char !== ' ') {
                        targets.push(span); // Add new targets
                    }
                });

                skillLine.appendChild(percentContainer);
                skillListElement.appendChild(skillLine);
            });
        }


        /**
         * 2. Pre-process text and wrap every letter in a <span> across ALL sections.
         */
        function initializeTargets() {
            // Ensures only non-skill targets are initialized if needed, and recalculates totals
            
            // Collect existing skill targets to keep them intact
            const existingTargets = targets.filter(span => span.closest('#skill-list'));
            targets = existingTargets;

            // Target all elements marked as destructible across the whole page *except* the skill list parent
            document.querySelectorAll(`.destructible-text`).forEach(element => {
                // If element already has children (meaning it's initialized or the skill list entry), skip
                if (element.children.length > 0 && element.children[0].tagName === 'SPAN') return;
                
                // If it's the skill list container itself, skip
                if (element.id === 'skill-list') return;


                const textContent = element.textContent.trim();
                element.innerHTML = ''; 
                
                textContent.split('').forEach(char => {
                    const span = document.createElement('span');
                    span.textContent = char === ' ' ? '\u00A0' : char; 
                    span.dataset.destroyed = 'false';
                    element.appendChild(span);
                    
                    if (char !== ' ') {
                        // Determine color based on section background
                        const section = element.closest('section');
                        const isKhakiSection = section.id === 'about' || section.id === 'projects';
                        span.style.color = isKhakiSection ? 'var(--color-maroon)' : 'var(--color-khaki)';
                        targets.push(span);
                    }
                });
            });

            // Recalculate total stats
            totalTargets = targets.length;
            destroyedTargets = targets.filter(span => span.dataset.destroyed === 'true').length; 
            updateHealthBar();
        }

        /**
         * 3. Health Bar and Game State Management
         */
        function updateHealthBar() {
            if (totalTargets === 0) return;

            const remainingPercentage = 100 - ((destroyedTargets / totalTargets) * 100);
            const clampedPercentage = Math.max(0, remainingPercentage);
            
            healthFillElement.style.width = `${clampedPercentage}%`; 
            
            // Simplified color control
            healthFillElement.style.background = 'linear-gradient(to right, var(--color-danger) 0%, #ffff00 50%, var(--color-safe) 100%)';

            // Check for Game Over condition
            if (destroyedTargets >= totalTargets && !gameOver) {
                gameOver = true;
                triggerGlitchEffect();
            }
        }

        // --- PROJECT PREVIEW FUNCTIONS (Hover Hologram) ---
        function showPreview(event, imageUrl) {
            if (gameOver) return;
            clearTimeout(hideTimeout);
            previewImage.src = imageUrl;
            
            const offsetX = 40; 
            const offsetY = 40; 
            
            let newX = mouseX + offsetX;
            let newY = mouseY + offsetY;

            const previewWidth = previewBox.offsetWidth || 416; 
            if (newX + previewWidth > window.innerWidth) { newX = mouseX - previewWidth - offsetX; }
            const previewHeight = previewBox.offsetHeight || 300; 
            if (newY + previewHeight > window.innerHeight) { newY = window.innerHeight - previewHeight - 10; }
            
            projectPreview.style.left = `${newX}px`;
            projectPreview.style.top = `${newY}px`;
            
            projectPreview.classList.remove('hidden');
            setTimeout(() => { projectPreview.style.opacity = '1'; }, 10); 
        }

        function hidePreview() {
            clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                projectPreview.style.opacity = '0';
                setTimeout(() => {
                    projectPreview.classList.add('hidden');
                }, 200); 
            }, 50);
        }
        
        // --- SKILL IMPLEMENTATIONS (Keys 1, 2, 3) ---

        function toggleSkillButtonVisual(skillId, isActive) {
            const skillEl = document.getElementById(skillId);
            if (!skillEl) return;
            if (isActive) {
                skillEl.classList.add('on');
            } else {
                skillEl.classList.remove('on');
            }
        }

        function toggleSpreadShot() {
            spreadShotActive = !spreadShotActive;
            document.getElementById('skill-1').textContent = `[1] SPREAD: ${spreadShotActive ? 'ON' : 'OFF'}`;
            toggleSkillButtonVisual('skill-1', spreadShotActive);
            lastBulletTime = 0; 
        }

        function repairTargets() {
            if (destroyedTargets === 0) return;
            const skillEl = document.getElementById('skill-2');
            skillEl.classList.add('pressed');
            setTimeout(() => {
                skillEl.classList.remove('pressed');
                explosionFlash.classList.remove('do-explosion'); 
            }, 500);

            explosionFlash.classList.add('do-explosion');
            
            const repairCount = Math.ceil(totalTargets * (REPAIR_AMOUNT / 100));
            const destroyedSpans = targets.filter(span => span.dataset.destroyed === 'true').reverse();
            const spansToRepair = destroyedSpans.slice(0, Math.min(repairCount, destroyedSpans.length));
            
            spansToRepair.forEach(span => {
                span.classList.remove('destroyed');
                span.dataset.destroyed = 'false';
                destroyedTargets--; 
            });

            updateHealthBar();
        }

        function toggleGunActive() {
            isFiring = !isFiring;
            document.getElementById('skill-3').textContent = `[3] GUN: ${isFiring ? 'ACTIVE' : 'OFF'}`;
            toggleSkillButtonVisual('skill-3', isFiring); 
        }

        /**
         * 4. Shatter Effect & Victory Glitch
         */
        function triggerShatter(x, y) {
            const pieceCount = 8;
            for (let i = 0; i < pieceCount; i++) {
                const piece = document.createElement('div');
                piece.className = 'shatter-piece';
                piece.style.left = `${x}px`;
                piece.style.top = `${y}px`;
                const angle = Math.random() * 2 * Math.PI;
                const distance = Math.random() * 30 + 10;
                
                setTimeout(() => {
                    piece.style.opacity = '0';
                    piece.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) rotate(${Math.random() * 360}deg)`;
                }, 10);
                confettiContainer.appendChild(piece); 
                setTimeout(() => piece.remove(), 550);
            }
        }
        
        function triggerGlitchEffect() {
            const glitchEl = document.getElementById('victory-glitch');
            if (!glitchEl) return;
            glitchEl.classList.add('rainbow-glitch-active');
            setTimeout(() => {
                glitchEl.classList.remove('rainbow-glitch-active');
            }, 5000); 
        }

        /**
         * 6. Cursor Tracking & Bullet Creation/Game Loop
         */
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            planeCursor.style.transform = `translate(${mouseX}px, ${mouseY}px)`;
        });
        
        document.addEventListener('keydown', (e) => {
            if (gameOver) return;
            switch (e.key) {
                case '1': toggleSpreadShot(); break;
                case '2': repairTargets(); break;
                case '3': toggleGunActive(); break;
            }
        });
        
        document.getElementById('skill-1').addEventListener('click', toggleSpreadShot);
        document.getElementById('skill-2').addEventListener('click', repairTargets);
        document.getElementById('skill-3').addEventListener('click', toggleGunActive);


        function createBullet() {
            if (gameOver || !isFiring) return; 
            
            const angles = spreadShotActive ? [-0.174, 0, 0.174] : [0]; 
            const startX = mouseX - 4; 
            const startY = mouseY - 16; 

            for (let i = 0; i < angles.length; i++) {
                const angle = angles[i];
                const bullet = document.createElement('div');
                bullet.className = 'bullet';
                
                bullet.style.left = `${startX}px`;
                bullet.style.top = `${startY}px`;

                const vx = Math.sin(angle) * BULLET_SPEED; 
                const vy = -Math.cos(angle) * BULLET_SPEED;
                
                const bulletObj = {
                    el: bullet, x: startX, y: startY, vx: vx, vy: vy
                };
                
                bullets.push(bulletObj);
                bulletContainer.appendChild(bullet);
            }
        }

        function gameLoop(currentTime) {
            requestAnimationFrame(gameLoop);

            const currentFireRate = spreadShotActive ? FIRE_RATE * 1.5 : FIRE_RATE;

            if (isFiring && currentTime - lastBulletTime > currentFireRate) {
                createBullet();
                lastBulletTime = currentTime;
            }
            
            bullets = bullets.filter(bullet => {
                bullet.x += bullet.vx;
                bullet.y += bullet.vy;
                bullet.el.style.left = `${bullet.x}px`;
                bullet.el.style.top = `${bullet.y}px`;

                if (bullet.y < 0) {
                    bullet.el.remove();
                    return false; 
                }

                let hit = false;
                for (let i = 0; i < targets.length; i++) {
                    const targetSpan = targets[i];
                    
                    if (targetSpan.dataset.destroyed === 'true') continue;

                    const rect = targetSpan.getBoundingClientRect();
                    const bulletSize = 8;
                    const collision = (
                        bullet.x < rect.right &&
                        bullet.x + bulletSize > rect.left &&
                        bullet.y < rect.bottom &&
                        bullet.y + bulletSize > rect.top
                    );
                    
                    if (collision) {
                        targetSpan.classList.add('destroyed');
                        targetSpan.dataset.destroyed = 'true';
                        
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        triggerShatter(centerX, centerY);

                        destroyedTargets++;
                        updateHealthBar();
                        
                        bullet.el.remove();
                        hit = true;
                        
                        break; 
                    }
                }
                return !hit; 
            });
        }

        window.onload = () => {
             // Glitching text content toggle
            let isDev = true;
            if (glitchTitleEl) {
                setInterval(() => {
                    isDev = !isDev;
                    glitchTitleEl.textContent = isDev ? 'DEV' : 'DESIGNER';
                }, 1200); 
            }

            setupSkillsMatrixSection(); 
            initializeTargets(); 
            
            toggleSkillButtonVisual('skill-1', spreadShotActive);
            toggleSkillButtonVisual('skill-3', isFiring);
            
            requestAnimationFrame(gameLoop);
        };

    </script>
</body>
</html>
